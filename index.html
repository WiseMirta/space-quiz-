<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cosmic Quiz Challenge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"
        integrity="sha384-mZLF4UVwJ0k5nqVu8dWcZY6QQwCtVjL2uZY+gMMDqRYGjmtjy2qvK1PLlF9Vjzl4"
        crossorigin="anonymous"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');

        body {
            font-family: 'Orbitron', monospace;
            background: linear-gradient(135deg, #0c0c2e 0%, #1a1a4a 50%, #2d1b69 100%);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }

        @keyframes twinkle {
            0%,
            100% {
                opacity: 0.3;
            }

            50% {
                opacity: 1;
            }
        }

        .content {
            position: relative;
            z-index: 10;
        }

        .cosmic-glow {
            box-shadow: 0 0 20px rgba(147, 51, 234, 0.5);
        }

        .planet {
            position: absolute;
            border-radius: 50%;
            opacity: 0.1;
        }

        .planet-1 {
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, #ff6b6b, #ee5a24);
            top: 10%;
            right: 10%;
            animation: float 6s ease-in-out infinite;
        }

        .planet-2 {
            width: 150px;
            height: 150px;
            background: radial-gradient(circle, #4834d4, #686de0);
            bottom: 20%;
            left: 5%;
            animation: float 8s ease-in-out infinite reverse;
        }

        @keyframes float {
            0%,
            100% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-20px);
            }
        }
    </style>
</head>

<body>
    <div class="stars" id="stars"></div>
    <div class="planet planet-1"></div>
    <div class="planet planet-2"></div>

    <div class="content min-h-screen flex items-center justify-center p-4">
        <div class="w-full max-w-4xl">
            <!-- Welcome Screen -->
            <div id="welcomeScreen" class="text-center">
                <h1 class="text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-400 mb-8">
                    üöÄ COSMIC QUIZ CHALLENGE üåå
                </h1>

                <div class="bg-gray-800/50 backdrop-blur-sm rounded-2xl p-8 cosmic-glow mb-8">
                    <h2 class="text-2xl font-bold text-white mb-6">Enter Your Space Explorer Name</h2>
                    <input type="text" id="playerName" placeholder="Captain Stardust"
                        class="w-full max-w-md px-6 py-3 bg-gray-700/50 border border-purple-500 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-400 mb-6">
                    <br>

                    <!-- Game Mode Selection -->
                    <h2 class="text-2xl font-bold text-white mb-6">Select Game Mode</h2>
                    <select id="gameMode"
                        class="w-full max-w-md px-6 py-3 bg-gray-700/50 border border-purple-500 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-purple-400 mb-6">
                        <option value="normal">Normal</option>
                        <option value="images">Images</option>
                        <option value="planets">Planets</option>
                    </select>
                    <br>

                    <button onclick="joinQuiz()"
                        class="px-8 py-4 bg-gradient-to-r from-purple-600 to-pink-600 text-white font-bold rounded-lg hover:from-purple-700 hover:to-pink-700 transform hover:scale-105 transition-all duration-200 cosmic-glow">
                        üöÄ Join Multiplayer Mission
                    </button>
                </div>

                <div class="text-gray-400">
                    <p>‚≠ê Points awarded for correct answers</p>
                    <p>üèÜ Winner announced at mission end</p>
                </div>
            </div>

            <!-- Lobby Screen -->
            <div id="lobbyScreen" class="hidden text-center">
                <h1 class="text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-blue-400 mb-8">
                    üõ∏ MISSION LOBBY üõ∏
                </h1>

                <div class="bg-gray-800/50 backdrop-blur-sm rounded-2xl p-8 cosmic-glow mb-8">
                    <div class="text-center mb-8">
                        <h3 class="text-2xl font-bold text-white mb-6">üöÄ Mission Crew</h3>
                        <div class="text-xl text-purple-300 mb-6">
                            <span id="playerCount">0</span> / 50 Explorers Joined
                        </div>
                        <div id="playersList"
                            class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-2 mb-6 max-h-96 overflow-y-auto">
                        </div>

                        <div class="bg-blue-600/20 border border-blue-400 rounded-lg p-4 mb-6">
                            <p class="text-blue-300 font-bold mb-2">üì± Share this link to invite friends:</p>
                            <div class="bg-gray-700/50 rounded-lg p-3 text-sm text-gray-300 break-all select-all cursor-pointer"
                                onclick="copyToClipboard()" id="shareUrl">
                                <span id="currentUrl"></span>
                            </div>
                            <p class="text-xs text-blue-400 mt-2">Click to copy ‚Ä¢ Share with other players to join the
                                mission!</p>
                        </div>
                    </div>

                    <div id="hostControls" class="hidden space-y-4">
                        <button onclick="startMultiplayerQuiz()"
                            class="px-8 py-4 bg-gradient-to-r from-green-600 to-blue-600 text-white font-bold rounded-lg hover:from-green-700 hover:to-blue-700 transform hover:scale-105 transition-all duration-200 cosmic-glow">
                            üöÄ Launch Quiz for All Explorers
                        </button>
                    </div>

                    <div id="waitingMessage" class="text-yellow-400 font-bold">
                        Waiting for mission commander to launch the quiz...
                    </div>
                </div>
            </div>

            <!-- Quiz Screen -->
            <div id="quizScreen" class="hidden">
                <div class="bg-gray-800/50 backdrop-blur-sm rounded-2xl p-8 cosmic-glow">
                    <div class="flex justify-between items-center mb-6">
                        <div class="text-purple-400 font-bold">
                            Question <span id="currentQuestion">1</span> of 14
                        </div>
                        <div class="text-yellow-400 font-bold">
                            ‚≠ê Your Score: <span id="currentScore">0</span>
                        </div>
                    </div>

                    <div class="w-full bg-gray-700 rounded-full h-3 mb-4">
                        <div id="progressBar"
                            class="bg-gradient-to-r from-purple-500 to-pink-500 h-3 rounded-full transition-all duration-500"
                            style="width: 7.69%"></div>
                    </div>

                    <div id="timerContainer" class="text-center mb-6">
                        <div class="text-2xl font-bold text-red-400">
                            ‚è∞ Time: <span id="timer">30</span>s
                        </div>
                    </div>

                    <h2 id="questionText" class="text-2xl font-bold text-white mb-8 leading-relaxed"></h2>

                    <div id="answersContainer" class="space-y-4 mb-8"></div>

                    <div id="waitingForNext" class="hidden text-center text-yellow-400 font-bold">
                        Waiting for all explorers to answer... üöÄ
                    </div>
                </div>
            </div>

            <!-- Results Screen -->
            <div id="resultsScreen" class="hidden text-center">
                <h1 class="text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-orange-400 mb-8">
                    üèÜ MISSION COMPLETE! üèÜ
                </h1>

                <div class="bg-gray-800/50 backdrop-blur-sm rounded-2xl p-8 cosmic-glow mb-8">
                    <h2 class="text-3xl font-bold text-white mb-6">Final Leaderboard</h2>
                    <div class="text-lg text-purple-300 mb-6">
                        <span id="totalParticipants">0</span> Space Explorers Completed the Mission
                    </div>
                    <div id="leaderboard" class="space-y-2 max-h-[500px] overflow-y-auto"></div>
                </div>

                <div id="hostRestartControls" class="hidden">
                    <button onclick="restartQuiz()"
                        class="px-8 py-4 bg-gradient-to-r from-green-600 to-blue-600 text-white font-bold rounded-lg hover:from-green-700 hover:to-blue-700 transform hover:scale-105 transition-all duration-200 cosmic-glow">
                        üîÑ New Mission
                    </button>
                </div>

                <div id="playerWaitingMessage" class="text-yellow-400 font-bold">
                    Mission complete! Waiting for commander to start new mission...
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game state
        let allPlayers = [];
        let currentPlayer = null;
        let currentQuestionIndex = 0;
        let selectedAnswer = null;
        let questions = []; // Questions will come from the server
        let gameState = 'lobby'; // lobby, playing, results
        let questionTimer = null;
        let timeLeft = 30;
        let gameSession = null;

        // Initialize stars
        function createStars() {
            const starsContainer = document.getElementById('stars');
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.width = Math.random() * 3 + 1 + 'px';
                star.style.height = star.style.width;
                star.style.animationDelay = Math.random() * 3 + 's';
                starsContainer.appendChild(star);
            }
        }

        function setupShareUrl() {
            const currentUrl = window.location.href;
            document.getElementById('currentUrl').textContent = currentUrl;
        }

        // Socket.IO connection
        const socket = io('http://localhost:3000'); // Replace with your server URL

        socket.on('connect', () => {
            console.log('Connected to server');
        });

        socket.on('disconnect', () => {
            console.log('Disconnected from server');
        });

        socket.on("sessionUpdate", (session) => {
            console.log("Session updated", session);
            allPlayers = session.players;
            gameState = session.gameState;
            questions = session.questions;

            if (gameState === 'lobby') {
                document.getElementById('quizScreen').classList.add('hidden');
                document.getElementById('resultsScreen').classList.add('hidden');
                document.getElementById('lobbyScreen').classList.remove('hidden');
                updateLobby();
            } else if (gameState === 'playing') {
                document.getElementById('lobbyScreen').classList.add('hidden');
                document.getElementById('resultsScreen').classList.add('hidden');
                document.getElementById('quizScreen').classList.remove('hidden');
            } else if (gameState === 'results') {
                document.getElementById('lobbyScreen').classList.add('hidden');
                document.getElementById('quizScreen').classList.add('hidden');
                document.getElementById('resultsScreen').classList.remove('hidden');
                showLeaderboard();
            }
        });

        socket.on("nextQuestion", (question) => {
            showQuestion(question);
        });

        socket.on("joinFailed", (data) => {
            alert(data.message);
        });

        function copyToClipboard() {
            const url = document.getElementById('currentUrl').textContent;
            navigator.clipboard.writeText(url).then(() => {
                // Show feedback
                const shareDiv = document.getElementById('shareUrl');
                const originalClass = shareDiv.className;
                shareDiv.className = originalClass + ' bg-green-600/30 border-green-400';

                setTimeout(() => {
                    shareDiv.className = originalClass;
                }, 1000);
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = url;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
            });
        }

        function joinQuiz() {
            const name = document.getElementById('playerName').value.trim();
            if (!name) {
                alert('Please enter your space explorer name!');
                return;
            }

            // Get the selected game mode
            const gameMode = document.getElementById('gameMode').value;

            const urlParams = new URLSearchParams(window.location.search);
            let sessionId = urlParams.get('session');

            // Send the gameMode to the server
            socket.emit("joinSession", { playerName: name, sessionId: sessionId, gameMode: gameMode });

            document.getElementById('welcomeScreen').classList.add('hidden');
            document.getElementById('lobbyScreen').classList.remove('hidden');
        }

        function updateLobby() {
            const playersList = document.getElementById('playersList');
            const playerCount = document.getElementById('playerCount');

            playersList.innerHTML = '';
            playerCount.textContent = allPlayers.length;

            allPlayers.forEach(player => {
                const playerDiv = document.createElement('div');
                playerDiv.className = 'bg-gray-700/50 border border-purple-500 rounded-lg p-1.5 text-center text-xs';
                playerDiv.innerHTML = `
                    <div class="text-white font-bold truncate" title="${player.name}">${player.name}</div>
                    <div class="text-green-400 text-xs">‚úì</div>
                `;
                playersList.appendChild(playerDiv);
            });

            // Setup share URL when first player joins
            if (allPlayers.length === 1) {
                setupShareUrl();
            } else {
                // Update share URL with current session
                const currentUrl = window.location.href;
                document.getElementById('currentUrl').textContent = currentUrl;
            }

            // Show host controls if user is host and there are players
            if (allPlayers.length > 0) {
                document.getElementById('hostControls').classList.remove('hidden');
                document.getElementById('waitingMessage').classList.add('hidden');
            }
        }

        function startMultiplayerQuiz() {
            socket.emit("startGame");
        }

        function showQuestion(question) {
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            document.getElementById('questionText').textContent = question.question;
            document.getElementById('currentScore').textContent = currentPlayer.score;

            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';

            const container = document.getElementById('answersContainer');
            container.innerHTML = '';
            selectedAnswer = null;

            question.answers.forEach((answer, index) => {
                const button = document.createElement('button');
                button.className = 'w-full p-4 text-left bg-gray-700/50 border border-gray-600 rounded-lg text-white hover:bg-purple-600/30 hover:border-purple-400 transition-all duration-200';

                if (question.hasImages) {
                    // Create pastry images using high-quality photos
                    let pastryImage = '';
                    if (index === 0) { // Pastel de Nata
                        pastryImage = `<img src="https://lmalimentar.pt/lojaLM/460-large_default/pastel-de-nata-cx-100-un.jpg" width="60" height="60" class="inline-block mr-3 rounded-lg object-cover" alt="Pastel de Nata">`;
                    } else if (index === 1) { // Pastel de Tent√∫gal
                        pastryImage = `<img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTdmN7TtKaWpYKLqrtEeSpHBsnDN1BJkdpDQA&s" width="60" height="60" class="inline-block mr-3 rounded-lg object-cover" alt="Pastel de Tent√∫gal">`;
                    } else if (index === 2) { // Bola de Berlim
                        pastryImage = `<img src="https://www.pingodoce.pt/wp-content/uploads/2017/09/bola-de-berlim.jpg" width="60" height="60" class="inline-block mr-3 rounded-lg object-cover" alt="Bola de Berlim">`;
                    } else { // Bolo de Arroz
                        pastryImage = `<img src="https://www.chefpanda.pt/wp-content/uploads/2020/11/Bolo-de-arroz.jpg" width="60" height="60" class="inline-block mr-3 rounded-lg object-cover" alt="Bolo de Arroz">`;
                    }
                    button.innerHTML = `<div class="flex items-center">${pastryImage}<span>${String.fromCharCode(65 + index)}. ${answer}</span></div>`;
                } else if (question.hasPlanets) {
                    // Add planet images for space questions
                    let planetImage = '';
                    const planetName = answer.toLowerCase();

                    if (planetName.includes('venus')) {
                        planetImage = `<img src="https://image.emojipng.com/220/2013220.jpg" width="60" height="60" class="inline-block mr-3 rounded-full object-cover" alt="Venus">`;
                    } else if (planetName.includes('mars')) {
                        planetImage = `<img src="https://attic.sh/wd5qfw2y4nm5e2fyq7n9ifpv36vn" width="60" height="60" class="inline-block mr-3 rounded-full object-cover" alt="Mars">`;
                    } else if (planetName.includes('jupiter')) {
                        planetImage = `<svg width="60" height="60" viewBox="0 0 60 60" class="inline-block mr-3">
                            <circle cx="30" cy="30" r="25" fill="url(#jupiterGradient${index})" stroke="#DAA520" stroke-width="2"/>
                            <defs>
                                <radialGradient id="jupiterGradient${index}" cx="0.3" cy="0.3">
                                    <stop offset="0%" stop-color="#F4A460"/>
                                    <stop offset="100%" stop-color="#D2691E"/>
                                </radialGradient>
                            </defs>
                            <ellipse cx="30" cy="22" rx="20" ry="3" fill="#CD853F" opacity="0.6"/>
                            <ellipse cx="30" cy="30" rx="22" ry="2" fill="#A0522D" opacity="0.7"/>
                            <ellipse cx="30" cy="38" rx="18" ry="2.5" fill="#8B4513" opacity="0.5"/>
                            <circle cx="35" cy="25" r="4" fill="#B22222" opacity="0.8"/>
                        </svg>`;
                    } else if (planetName.includes('saturn')) {
                        planetImage = `<svg width="60" height="60" viewBox="0 0 60 60" class="inline-block mr-3">
                            <ellipse cx="30" cy="30" rx="35" ry="8" fill="none" stroke="#DAA520" stroke-width="2" opacity="0.7"/>
                            <ellipse cx="30" cy="30" rx="30" ry="6" fill="none" stroke="#DAA520" stroke-width="1" opacity="0.5"/>
                            <circle cx="30" cy="30" r="18" fill="url(#saturnGradient${index})" stroke="#DAA520" stroke-width="2"/>
                            <defs>
                                <radialGradient id="saturnGradient${index}" cx="0.3" cy="0.3">
                                    <stop offset="0%" stop-color="#F0E68C"/>
                                    <stop offset="100%" stop-color="#BDB76B"/>
                                </radialGradient>
                            </defs>
                            <ellipse cx="30" cy="25" rx="15" ry="2" fill="#DAA520" opacity="0.4"/>
                            <ellipse cx="30" cy="35" rx="12" ry="1.5" fill="#DAA520" opacity="0.3"/>
                        </svg>`;
                    } else if (planetName.includes('mercury')) {
                        planetImage = `<img src="https://tse1.explicit.bing.net/th/id/OIP.2sZgza3B-m6lu7b0vBaEWQHaHa?rs=1&pid=ImgDetMain&o=7&rm=3" width="60" height="60" class="inline-block mr-3 rounded-full object-cover" alt="Mercury">`;
                    } else if (planetName.includes('neptune')) {
                        planetImage = `<svg width="60" height="60" viewBox="0 0 60 60" class="inline-block mr-3">
                            <circle cx="30" cy="30" r="25" fill="url(#neptuneGradient${index})" stroke="#4169E1" stroke-width="2"/>
                            <defs>
                                <radialGradient id="neptuneGradient${index}" cx="0.3" cy="0.3">
                                    <stop offset="0%" stop-color="#87CEEB"/>
                                    <stop offset="100%" stop-color="#191970"/>
                                </radialGradient>
                            </defs>
                            <circle cx="25" cy="28" r="3" fill="#00BFFF" opacity="0.6"/>
                            <circle cx="38" cy="32" r="2" fill="#00BFFF" opacity="0.4"/>
                        </svg>`;
                    } else if (planetName.includes('uranus')) {
                        planetImage = `<svg width="60" height="60" viewBox="0 0 60 60" class="inline-block mr-3">
                            <circle cx="30" cy="30" r="25" fill="url(#uranusGradient${index})" stroke="#4FD0E7" stroke-width="2"/>
                            <defs>
                                <radialGradient id="uranusGradient${index}" cx="0.3" cy="0.3">
                                    <stop offset="0%" stop-color="#E0FFFF"/>
                                    <stop offset="100%" stop-color="#008B8B"/>
                                </radialGradient>
                            </defs>
                            <ellipse cx="30" cy="30" rx="30" ry="5" fill="none" stroke="#4FD0E7" stroke-width="1" opacity="0.6" transform="rotate(45 30 30)"/>
                            <ellipse cx="30" cy="30" rx="25" ry="4" fill="none" stroke="#4FD0E7" stroke-width="1" opacity="0.4" transform="rotate(45 30 30)"/>
                        </svg>`;
                    } else if (planetName.includes('earth')) {
                        planetImage = `<img src="https://tse3.mm.bing.net/th/id/OIP.-bluNjlpoAL0dHd1xt92JAHaFN?rs=1&pid=ImgDetMain&o=7&rm=3" width="60" height="60" class="inline-block mr-3 rounded-full object-cover" alt="Earth">`;
                    } else {
                        planetImage = `<img src="https://static.vecteezy.com/system/resources/previews/008/055/235/original/planet-icon-isolated-on-white-background-vector.jpg" width="60" height="60" class="inline-block mr-3 rounded-full object-cover" alt="Planet">`;
                    }

                    button.innerHTML = `<div class="flex items-center">${planetImage}<span>${String.fromCharCode(65 + index)}. ${answer}</span></div>`;
                } else {
                    button.textContent = String.fromCharCode(65 + index) + '. ' + answer;
                }

                button.onclick = () => selectAnswer(index);
                container.appendChild(button);
            });

            startTimer();
        }

        createStars();
    </script>
</body>

</html>
